{"ast":null,"code":"/*\r\n * Copyright (c) 2015-present, Vitaly Tomilov\r\n *\r\n * See the LICENSE file at the top-level directory of this distribution\r\n * for licensing information.\r\n *\r\n * Removal or modification of this copyright notice is prohibited.\r\n */\n\n/**\r\n * @class ConnectionContext\r\n * @private\r\n * @summary Internal connection context.\r\n *\r\n * @param {object} cc\r\n * Connection Context.\r\n *\r\n * @param {object} cc.cn\r\n * Connection details\r\n *\r\n * @param {*} cc.dc\r\n * Database Context\r\n *\r\n * @param {object} cc.options\r\n * Library's Initialization Options\r\n *\r\n * @param {object} cc.db\r\n * Database Session we're attached to, if any.\r\n *\r\n * @param {number} cc.level\r\n * Task Level\r\n *\r\n * @param {number} cc.txLevel\r\n * Transaction Level\r\n *\r\n * @param {object} cc.parentCtx\r\n * Connection Context of the parent operation, if any.\r\n *\r\n */\nclass ConnectionContext {\n  constructor(cc) {\n    this.cn = cc.cn; // connection details;\n    this.dc = cc.dc; // database context;\n    this.options = cc.options; // library options;\n    this.db = cc.db; // database session;\n    this.level = cc.level; // task level;\n    this.txLevel = cc.txLevel; // transaction level;\n    this.parentCtx = null; // parent context\n    this.taskCtx = null; // task context\n    this.start = null; // Date/Time when connected\n    this.txCount = 0;\n  }\n  connect(db) {\n    this.db = db;\n    this.start = new Date();\n  }\n  disconnect(kill) {\n    if (this.db) {\n      const p = this.db.release(kill);\n      this.db = null;\n      return p;\n    }\n  }\n  clone() {\n    const obj = new ConnectionContext(this);\n    obj.parent = this;\n    obj.parentCtx = this.taskCtx;\n    return obj;\n  }\n  get nextTxCount() {\n    let txCurrent = this,\n      txTop = this;\n    while (txCurrent.parent) {\n      txCurrent = txCurrent.parent;\n      if (txCurrent.taskCtx && txCurrent.taskCtx.isTX) {\n        txTop = txCurrent;\n      }\n    }\n    return txTop.txCount++;\n  }\n}\n\n/**\r\n * Connection Context\r\n * @module context\r\n * @author Vitaly Tomilov\r\n * @private\r\n */\nmodule.exports = {\n  ConnectionContext\n};","map":{"version":3,"names":["ConnectionContext","constructor","cc","cn","dc","options","db","level","txLevel","parentCtx","taskCtx","start","txCount","connect","Date","disconnect","kill","p","release","clone","obj","parent","nextTxCount","txCurrent","txTop","isTX","module","exports"],"sources":["/Users/luna/Library/Mobile Documents/com~apple~CloudDocs/GitHub/paucamcal.github.io/AESP/node_modules/pg-promise/lib/context.js"],"sourcesContent":["/*\r\n * Copyright (c) 2015-present, Vitaly Tomilov\r\n *\r\n * See the LICENSE file at the top-level directory of this distribution\r\n * for licensing information.\r\n *\r\n * Removal or modification of this copyright notice is prohibited.\r\n */\r\n\r\n/**\r\n * @class ConnectionContext\r\n * @private\r\n * @summary Internal connection context.\r\n *\r\n * @param {object} cc\r\n * Connection Context.\r\n *\r\n * @param {object} cc.cn\r\n * Connection details\r\n *\r\n * @param {*} cc.dc\r\n * Database Context\r\n *\r\n * @param {object} cc.options\r\n * Library's Initialization Options\r\n *\r\n * @param {object} cc.db\r\n * Database Session we're attached to, if any.\r\n *\r\n * @param {number} cc.level\r\n * Task Level\r\n *\r\n * @param {number} cc.txLevel\r\n * Transaction Level\r\n *\r\n * @param {object} cc.parentCtx\r\n * Connection Context of the parent operation, if any.\r\n *\r\n */\r\nclass ConnectionContext {\r\n\r\n    constructor(cc) {\r\n        this.cn = cc.cn; // connection details;\r\n        this.dc = cc.dc; // database context;\r\n        this.options = cc.options; // library options;\r\n        this.db = cc.db; // database session;\r\n        this.level = cc.level; // task level;\r\n        this.txLevel = cc.txLevel; // transaction level;\r\n        this.parentCtx = null; // parent context\r\n        this.taskCtx = null; // task context\r\n        this.start = null; // Date/Time when connected\r\n        this.txCount = 0;\r\n    }\r\n\r\n    connect(db) {\r\n        this.db = db;\r\n        this.start = new Date();\r\n    }\r\n\r\n    disconnect(kill) {\r\n        if (this.db) {\r\n            const p = this.db.release(kill);\r\n            this.db = null;\r\n            return p;\r\n        }\r\n    }\r\n\r\n    clone() {\r\n        const obj = new ConnectionContext(this);\r\n        obj.parent = this;\r\n        obj.parentCtx = this.taskCtx;\r\n        return obj;\r\n    }\r\n\r\n    get nextTxCount() {\r\n        let txCurrent = this, txTop = this;\r\n        while (txCurrent.parent) {\r\n            txCurrent = txCurrent.parent;\r\n            if (txCurrent.taskCtx && txCurrent.taskCtx.isTX) {\r\n                txTop = txCurrent;\r\n            }\r\n        }\r\n        return txTop.txCount++;\r\n    }\r\n}\r\n\r\n/**\r\n * Connection Context\r\n * @module context\r\n * @author Vitaly Tomilov\r\n * @private\r\n */\r\nmodule.exports = {ConnectionContext};\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,iBAAiB,CAAC;EAEpBC,WAAWA,CAACC,EAAE,EAAE;IACZ,IAAI,CAACC,EAAE,GAAGD,EAAE,CAACC,EAAE,CAAC,CAAC;IACjB,IAAI,CAACC,EAAE,GAAGF,EAAE,CAACE,EAAE,CAAC,CAAC;IACjB,IAAI,CAACC,OAAO,GAAGH,EAAE,CAACG,OAAO,CAAC,CAAC;IAC3B,IAAI,CAACC,EAAE,GAAGJ,EAAE,CAACI,EAAE,CAAC,CAAC;IACjB,IAAI,CAACC,KAAK,GAAGL,EAAE,CAACK,KAAK,CAAC,CAAC;IACvB,IAAI,CAACC,OAAO,GAAGN,EAAE,CAACM,OAAO,CAAC,CAAC;IAC3B,IAAI,CAACC,SAAS,GAAG,IAAI,CAAC,CAAC;IACvB,IAAI,CAACC,OAAO,GAAG,IAAI,CAAC,CAAC;IACrB,IAAI,CAACC,KAAK,GAAG,IAAI,CAAC,CAAC;IACnB,IAAI,CAACC,OAAO,GAAG,CAAC;EACpB;EAEAC,OAAOA,CAACP,EAAE,EAAE;IACR,IAAI,CAACA,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACK,KAAK,GAAG,IAAIG,IAAI,CAAC,CAAC;EAC3B;EAEAC,UAAUA,CAACC,IAAI,EAAE;IACb,IAAI,IAAI,CAACV,EAAE,EAAE;MACT,MAAMW,CAAC,GAAG,IAAI,CAACX,EAAE,CAACY,OAAO,CAACF,IAAI,CAAC;MAC/B,IAAI,CAACV,EAAE,GAAG,IAAI;MACd,OAAOW,CAAC;IACZ;EACJ;EAEAE,KAAKA,CAAA,EAAG;IACJ,MAAMC,GAAG,GAAG,IAAIpB,iBAAiB,CAAC,IAAI,CAAC;IACvCoB,GAAG,CAACC,MAAM,GAAG,IAAI;IACjBD,GAAG,CAACX,SAAS,GAAG,IAAI,CAACC,OAAO;IAC5B,OAAOU,GAAG;EACd;EAEA,IAAIE,WAAWA,CAAA,EAAG;IACd,IAAIC,SAAS,GAAG,IAAI;MAAEC,KAAK,GAAG,IAAI;IAClC,OAAOD,SAAS,CAACF,MAAM,EAAE;MACrBE,SAAS,GAAGA,SAAS,CAACF,MAAM;MAC5B,IAAIE,SAAS,CAACb,OAAO,IAAIa,SAAS,CAACb,OAAO,CAACe,IAAI,EAAE;QAC7CD,KAAK,GAAGD,SAAS;MACrB;IACJ;IACA,OAAOC,KAAK,CAACZ,OAAO,EAAE;EAC1B;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACAc,MAAM,CAACC,OAAO,GAAG;EAAC3B;AAAiB,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}